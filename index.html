<!DOCTYPE html>
<html>
<head>
  <title>Form Data</title>
  <meta charset="UTF-8">
  <style>
    body { font-family: Arial; max-width: 600px; margin: auto; padding: 20px; }
    input, button { display: block; margin: 10px 0; width: 100%; padding: 8px; }
    #formUpdate, #idField { display: none; }
    #hasilPencarian button {
      text-align: left;
      margin-bottom: 5px;
      background-color: #f1f1f1;
      border: 1px solid #ccc;
      cursor: pointer;
    }
    #hasilPencarian button:hover {
      background-color: #ddd;
    }
  </style>
</head>
<body>
  <h2>Form Input Data</h2>

  <!-- FORM INPUT DATA -->
  <form id="dataForm">
    <input type="text" id="nama" placeholder="Nama" required>
    <input type="number" id="umur" placeholder="Umur" required>
    <button type="submit">Kirim</button>
  </form>

  <!-- FORM CARI -->
  <h3>Cari dan Update Data</h3>
  <input type="text" id="searchNama" placeholder="Masukkan nama">
  <button onclick="cariData()">Cari</button>
  <div id="hasilPencarian"></div>

  <!-- FORM UPDATE DATA -->
  <form id="formUpdate">
    <input type="hidden" id="idField">
    <input type="text" id="editNama" placeholder="Nama" required>
    <input type="number" id="editUmur" placeholder="Umur" required>
    <button type="button" id="updateBtn" onclick="updateData()">Update</button>
  </form>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycby0BMxT8GWmgbae0muP_PG9xl-pQG3sLEugh9hakOHXsM8JwQ2bNmWMQrrbUhVBGOmS/exec";

    // Kirim data baru
    document.getElementById('dataForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const formData = new FormData();
      formData.append("action", "add");
      formData.append("nama", document.getElementById("nama").value);
      formData.append("umur", document.getElementById("umur").value);

      fetch(scriptURL, { method: 'POST', body: formData })
        .then(res => res.text())
        .then(res => {
          alert("Data berhasil dikirim!");
          document.getElementById('dataForm').reset();
        });
    });

    // Cari data nama dan tampilkan list
    function cariData() {
      const nama = document.getElementById("searchNama").value;
      const hasilDiv = document.getElementById("hasilPencarian");
      hasilDiv.innerHTML = "Mencari...";
      fetch(`${scriptURL}?action=list&nama=${encodeURIComponent(nama)}`)
        .then(res => res.json())
        .then(res => {
          hasilDiv.innerHTML = "";
          if (res.success && res.data.length > 0) {
            res.data.forEach(item => {
              const btn = document.createElement("button");
              btn.textContent = `ID: ${item.id} | Nama: ${item.nama} | Umur: ${item.umur}`;
              btn.onclick = () => isiFormUpdate(item);
              hasilDiv.appendChild(btn);
            });
          } else {
            hasilDiv.innerHTML = "<p>Data tidak ditemukan.</p>";
            document.getElementById("formUpdate").style.display = "none";
          }
        });
    }

    // Isi form update dari tombol klik hasil pencarian
    function isiFormUpdate(data) {
      document.getElementById("idField").value = data.id;
      document.getElementById("editNama").value = data.nama;
      document.getElementById("editUmur").value = data.umur;
      document.getElementById("formUpdate").style.display = "block";
      document.getElementById("updateBtn").style.display = "block";
    }

    // Update data
    function updateData() {
      const formData = new FormData();
      formData.append("action", "update");
      formData.append("id", document.getElementById("idField").value);
      formData.append("nama", document.getElementById("editNama").value);
      formData.append("umur", document.getElementById("editUmur").value);

      fetch(scriptURL, { method: 'POST', body: formData })
        .then(res => res.text())
        .then(res => {
          alert("Data berhasil diperbarui!");
          document.getElementById("formUpdate").reset();
          document.getElementById("formUpdate").style.display = "none";
          document.getElementById("hasilPencarian").innerHTML = "";
        });
    }
  </script>
</body>
</html>
